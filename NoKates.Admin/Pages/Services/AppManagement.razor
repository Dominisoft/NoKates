@using NoKates.Admin.Clients
@using NoKates.Common.Infrastructure.Client
@using NoKates.Common.Infrastructure.Extensions
@using Blazored.LocalStorage
@inject IWebHostManagementClient WebHostManagementClient;
@inject INoKatesCoreClient CoreClient;
@inject ILocalStorageService storage;

@page "/Services/AppManagement"
@code {

    public List<string> UnreferencedDirectories { get; set; } = new List<string>();
    public List<string> InstalledApps { get; set; } = new List<string>();
    public string AddApp { get; set; }
    public string RemoveApp { get; set; }


    protected override async Task OnInitializedAsync()
    {
        //var token = Request.GetToken();
        //if (TokenHelper.TokenIsInvalid(token))
        //{
        //    HttpContext.RedirectToRelativePath("Session/Login");
        //    return;
        //}
        //RemoveApp = Request.Query[nameof(RemoveApp)];
        //AddApp = Request.Query[nameof(AddApp)];
        //if (string.IsNullOrWhiteSpace(RemoveApp) && string.IsNullOrWhiteSpace(AddApp))
        //{
        //    LoadData(token);
        //    return;
        //}

        //if (!string.IsNullOrWhiteSpace(AddApp))
        //    Add();
        //else
        //    Remove();
        var token = await storage.GetItemAsStringAsync("AuthorizationToken");

        LoadData(token);
    }
    public  void LoadData(string token)
    {
        UnreferencedDirectories = WebHostManagementClient.GetUnreferencedDirectories(token)??new List<string>();
        InstalledApps = CoreClient.GetAllServiceNames(token)?.ThrowIfError()?.ToList()??new List<string>();

    }
}
<div>
    <form>
        <select class="custom-select"  title="App is required"   asp-for="AddApp">  
            <option value="Select" selected disabled="disabled">(Choose App)</option>  
            @foreach (var app in @UnreferencedDirectories)
            {  
                    <option value="@app"> @app</option>  
            }  
        </select>  
        <button onclick="this.form.submit()">Add Application</button>
    </form>


    <br/>
    <br/>
    <br/>
    <form>
        <select class="custom-select"  title="App is required"   asp-for="RemoveApp">  
            <option value="Select" selected disabled="disabled">(Choose App)</option>  
            @foreach (var app in @InstalledApps)
            {  
                    <option value="@app"> @app</option>  
            }  
        </select>  
        <button onclick="this.form.submit()">Remove Application</button>
    </form>

</div>